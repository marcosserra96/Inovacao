<!DOCTYPE html> <html lang="pt-BR"> <head> <meta charset="UTF-8" /> <meta name="viewport" content="width=device-width, initial-scale=1.0"/> <title>Quiz EMR â€” InÃ­cio</title> <link rel="stylesheet" href="assets/styles.css?v=9"/> </head> <body> <header class="header"> <div class="brand"> <span class="logo-dot"></span><span class="title">Quiz EMR</span> </div> <div class="badge">Evento</div> </header> <section class="card"> <div class="grid-home"> <!-- HERO (form) --> <div class="hero"> <h1>Pronto para jogar? ğŸ¯</h1> <p>Responda rÃ¡pido e acerte para pontuar mais. Visual claro com cartÃµes no estilo Energisa.</p> <form id="start-form" class="form"> <input id="name" class="input" type="text" placeholder="Seu nome" required/> <input id="email" class="input" type="email" placeholder="Seu e-mail (empresa)" required/> <button class="btn btn-pill btn-primary" type="submit">ComeÃ§ar agora</button> </form> <p class="muted" style="margin-top:10px">Ao iniciar, vocÃª concorda em aparecer no ranking do evento.</p> </div> <!-- RANKING --> <aside class="side"> <h2>ğŸ† Ranking em tempo real</h2> <table class="table"> <thead><tr><th>#</th><th>Nome</th><th>Pontos</th><th>Tempo</th></tr></thead> <tbody id="ranking-rows"> <tr><td colspan="4" class="muted" style="padding:14px;">Carregandoâ€¦</td></tr> </tbody> </table> <p class="muted">Desempate por menor tempo total.</p> </aside> </div> </section> <script type="module"> import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js"; import { getFirestore, collection, query, orderBy, limit, onSnapshot, getDocs } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js"; // âš™ï¸ Mesmo projeto do quiz const firebaseConfig = { apiKey: "AIzaSyC2l8LU3vYfQjTly8JSa658mfIlVk2Dw8E", authDomain: "inovacao-emr.firebaseapp.com", projectId: "inovacao-emr", storageBucket: "inovacao-emr.firebasestorage.app", messagingSenderId: "1075399271811", appId: "1:1075399271811:web:f532f25547125d6a8f42b6", measurementId: "G-8CTLMNCZJN" }; const app = initializeApp(firebaseConfig); const db = getFirestore(app); // âœ Navega para o quiz com nome/email document.getElementById('start-form').addEventListener('submit',(e)=>{ e.preventDefault(); const name = document.getElementById('name').value.trim(); const email = document.getElementById('email').value.trim(); if(!name || !email) return; const qs = new URLSearchParams({ name, email }).toString(); location.href = quiz.html?${qs}; }); const rows = document.getElementById('ranking-rows'); const fmt = (t)=> Number.isFinite(+t) ? ${(+t).toFixed(1)}s : "-"; function renderData(data){ rows.innerHTML = ""; if (!data.length){ rows.innerHTML = <tr><td colspan="4" class="muted" style="padding:14px;">Sem resultados ainda.</td></tr>; return; } let pos = 1; data.forEach(d=>{ let medal = pos; if (pos===1) medal="ğŸ†"; else if (pos===2) medal="ğŸ¥ˆ"; else if (pos===3) medal="ğŸ¥‰"; const tr = document.createElement('tr'); tr.innerHTML = <td>${medal}</td> <td>${(d.name||"-").toString().slice(0,48)}</td> <td><strong>${d.score ?? 0}</strong></td> <td>${fmt(d.totalTime)}</td> ; rows.appendChild(tr); pos++; }); } // ğŸ”´ Fallback robusto: tenta getDocs primeiro (mostra jÃ¡ algo), // depois liga o onSnapshot; se der erro, mostra mensagem clara. async function startLive(){ try{ const baseQ = query(collection(db,"scores"), orderBy("score","desc"), limit(20)); // prÃ©-carrega (caso onSnapshot demore) const snap = await getDocs(baseQ); const pre = []; snap.forEach(d=>pre.push(d.data())); pre.sort((a,b)=> (b.score??0)-(a.score??0) || (a.totalTime??9e9)-(b.totalTime??9e9)); renderData(pre); onSnapshot(baseQ, (s)=>{ const arr=[]; s.forEach(d=>arr.push(d.data())); arr.sort((a,b)=> (b.score??0)-(a.score??0) || (a.totalTime??9e9)-(b.totalTime??9e9)); renderData(arr); }, (e)=>{ console.error("onSnapshot error:", e?.code, e?.message); rows.innerHTML = <tr><td colspan="4" class="muted" style="padding:14px;"> Erro ao carregar ranking (${e?.code||"desconhecido"}). Verifique as <b>Regras do Firestore</b> e o <b>firebaseConfig</b>. </td></tr>; }); }catch(e){ console.error("getDocs error:", e?.code, e?.message); rows.innerHTML = <tr><td colspan="4" class="muted" style="padding:14px;"> Erro ao consultar ranking (${e?.code||"desconhecido"}). </td></tr>; } } startLive(); </script> </body> </html>
