<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Administra√ß√£o - Quiz EMR</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js';
    import { getFirestore, doc, getDoc, setDoc } from 'https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js';

    const firebaseConfig = {
      apiKey: "AIzaSyC2l8LU3vYfQjTly8JSa658mfIlVk2Dw8E",
      authDomain: "inovacao-emr.firebaseapp.com",
      projectId: "inovacao-emr",
      storageBucket: "inovacao-emr.firebasestorage.app",
      messagingSenderId: "1075399271811",
      appId: "1:1075399271811:web:f532f25547125d6a8f42b6",
      measurementId: "G-8CTLMNCZJN"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    async function checkLogin() {
      const input = prompt('Digite a senha de administrador:');
      const ref = doc(db, 'config', 'admin');
      const snap = await getDoc(ref);
      const realPass = snap.exists() ? snap.data().password : 'emr2025';
      if (input !== realPass) {
        alert('Senha incorreta.');
        location.href = 'index.html';
      }
    }

    window.addEventListener('DOMContentLoaded', checkLogin);

    async function loadData() {
      const qSnap = await getDoc(doc(db, 'config', 'questions'));
      const gSnap = await getDoc(doc(db, 'config', 'general'));
      const aSnap = await getDoc(doc(db, 'config', 'appearance'));

      const questions = qSnap.exists() ? qSnap.data().list : [];
      const general = gSnap.exists() ? gSnap.data() : {};
      const appearance = aSnap.exists() ? aSnap.data() : {};

      renderQuestions(questions);
      document.getElementById('timePerQuestion').value = general.timePerQuestion || 20;
      document.getElementById('quizTitle').value = appearance.quizTitle || 'Quiz EMR';
      document.getElementById('primaryColor').value = appearance.primaryColor || '#009BC1';
    }

    function renderQuestions(questions) {
      const container = document.getElementById('questionsList');
      container.innerHTML = '';
      questions.forEach((q, i) => {
        const div = document.createElement('div');
        div.className = 'card mb-3 p-3 shadow-sm';
        div.innerHTML = `
          <input type='text' class='form-control mb-2' placeholder='T√≠tulo da pergunta' value='${q.title}' />
          ${q.options.map((opt, j) => `<input type='text' class='form-control mb-1' placeholder='Op√ß√£o ${j+1}' value='${opt}' />`).join('')}
          <input type='number' class='form-control mt-1' value='${q.answerIndex}' min='0' max='3' placeholder='√çndice da resposta correta' />
        `;
        container.appendChild(div);
      });
    }

    async function saveAll() {
      const cards = document.querySelectorAll('#questionsList .card');
      const list = Array.from(cards).map(card => {
        const inputs = card.querySelectorAll('input');
        const title = inputs[0].value;
        const options = [inputs[1].value, inputs[2].value, inputs[3].value, inputs[4].value];
        const answerIndex = parseInt(inputs[5].value);
        return { title, options, answerIndex };
      });

      const general = {
        timePerQuestion: parseInt(document.getElementById('timePerQuestion').value)
      };

      const appearance = {
        quizTitle: document.getElementById('quizTitle').value,
        primaryColor: document.getElementById('primaryColor').value
      };

      await setDoc(doc(db, 'config', 'questions'), { list });
      await setDoc(doc(db, 'config', 'general'), general);
      await setDoc(doc(db, 'config', 'appearance'), appearance);
      alert('Altera√ß√µes salvas com sucesso!');
    }

    window.addEventListener('DOMContentLoaded', () => {
      loadData();
      document.getElementById('saveBtn').addEventListener('click', saveAll);
    });
  </script>

  <style>
    body {
      background: #f6f8fa;
      font-family: 'Segoe UI', sans-serif;
    }
    .nav-tabs .nav-link.active {
      background-color: #009BC1;
      color: white !important;
      border: none;
    }
    .nav-tabs .nav-link {
      color: #009BC1;
    }
    #saveBtn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      border-radius: 40px;
      padding: 12px 22px;
      background-color: #009BC1;
      color: white;
      border: none;
      font-weight: 600;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      transition: all 0.3s ease;
    }
    #saveBtn:hover {
      transform: scale(1.05);
      background-color: #007b9c;
    }
  </style>
</head>
<body class="p-4">
  <h1 class="mb-4">‚öôÔ∏è Administra√ß√£o do Quiz EMR</h1>

  <ul class="nav nav-tabs mb-3" id="adminTabs" role="tablist">
    <li class="nav-item" role="presentation">
      <button class="nav-link active" id="tab-questions" data-bs-toggle="tab" data-bs-target="#questions" type="button" role="tab">Perguntas</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="tab-general" data-bs-toggle="tab" data-bs-target="#general" type="button" role="tab">Configura√ß√µes</button>
    </li>
    <li class="nav-item" role="presentation">
      <button class="nav-link" id="tab-appearance" data-bs-toggle="tab" data-bs-target="#appearance" type="button" role="tab">Apar√™ncia</button>
    </li>
  </ul>

  <div class="tab-content" id="adminTabsContent">
    <div class="tab-pane fade show active" id="questions" role="tabpanel">
      <div id="questionsList" class="mt-3"></div>
      <button class="btn btn-outline-primary mt-2" onclick="document.getElementById('questionsList').insertAdjacentHTML('beforeend',`<div class='card mb-3 p-3 shadow-sm'><input type='text' class='form-control mb-2' placeholder='T√≠tulo da pergunta' /><input type='text' class='form-control mb-1' placeholder='Op√ß√£o 1' /><input type='text' class='form-control mb-1' placeholder='Op√ß√£o 2' /><input type='text' class='form-control mb-1' placeholder='Op√ß√£o 3' /><input type='text' class='form-control mb-1' placeholder='Op√ß√£o 4' /><input type='number' class='form-control mt-1' placeholder='√çndice da resposta correta' min='0' max='3' /></div>`)">+ Adicionar Pergunta</button>
    </div>

    <div class="tab-pane fade" id="general" role="tabpanel">
      <div class="mt-3">
        <label class="form-label">‚è± Tempo por pergunta (segundos)</label>
        <input id="timePerQuestion" type="number" class="form-control" min="5" max="120" />
      </div>
    </div>

    <div class="tab-pane fade" id="appearance" role="tabpanel">
      <div class="mt-3">
        <label class="form-label">üè∑Ô∏è T√≠tulo do quiz</label>
        <input id="quizTitle" type="text" class="form-control" />
        <label class="form-label mt-3">üé® Cor principal</label>
        <input id="primaryColor" type="color" class="form-control form-control-color" />
      </div>
    </div>
  </div>

  <button id="saveBtn">Salvar altera√ß√µes</button>
</body>
</html>
