<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Placar ‚Äî Quiz EMR</title>

<style>
  :root{
    --teal:#009BC1; --green:#59C085;
    --dark:#0A1A1F; --text:#fff; --muted:#A8B8C0;
  }
  *{box-sizing:border-box}
  html,body{
    margin:0; padding:0; width:100%; height:100%;
    font-family:"Segoe UI", Inter, sans-serif;
    background: radial-gradient(circle at top left, var(--teal) -30%, transparent 70%),
                radial-gradient(circle at bottom right, var(--green) -30%, transparent 70%),
                var(--dark);
    color:var(--text);
    overflow:hidden;
  }

  .container{
    width:100%; height:100%;
    display:flex; flex-direction:column;
    align-items:center; justify-content:space-between;
    padding:20px;
  }

  /* Ranking */
  .ranking{
    width:100%; text-align:center;
  }
  .ranking h1{
    margin:0 0 12px; font-size:36px; font-weight:900;
  }
  .rank-list{
    list-style:none; margin:0; padding:0;
    display:flex; flex-direction:column; gap:10px;
    max-width:100%;
  }
  .rank-item{
    display:flex; justify-content:space-between; align-items:center;
    padding:14px 20px; border-radius:14px;
    font-size:22px; font-weight:700;
    background:rgba(255,255,255,.05);
  }
  .rank-item span{flex:1;text-align:left}
  .rank-pos{width:40px; text-align:center}
  .gold{color:#FFD700}
  .silver{color:#C0C0C0}
  .bronze{color:#CD7F32}

  /* Curiosidades */
  .facts{
    text-align:center; font-size:20px; font-weight:600;
    min-height:80px; max-width:90%;
  }
  .fact{opacity:0; transition:opacity .6s ease}
  .fact.active{opacity:1}

  /* QR */
  .qr-block{
    position:relative; display:flex; flex-direction:column; align-items:center;
  }
  .qr{
    width:220px; height:220px; border-radius:20px;
    border:6px solid #fff; box-shadow:0 0 20px rgba(0,0,0,.5);
  }
  .qr-pulse{
    position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
    width:260px; height:260px; border-radius:50%;
    box-shadow:0 0 0 0 rgba(0,155,193,.4);
    animation:pulse 2s infinite;
  }
  @keyframes pulse{
    0%{box-shadow:0 0 0 0 rgba(0,155,193,.4)}
    70%{box-shadow:0 0 0 30px rgba(0,155,193,0)}
    100%{box-shadow:0 0 0 0 rgba(0,155,193,0)}
  }
  .cta{
    margin-top:10px; font-size:18px; font-weight:800; color:var(--muted);
  }
</style>
</head>
<body>
  <div class="container">
    <!-- Ranking -->
    <div class="ranking">
      <h1>üèÜ TOP 5</h1>
      <ul id="rank" class="rank-list">
        <li class="rank-item"><div class="rank-pos">‚Äì</div><span>Carregando‚Ä¶</span><div>0</div></li>
      </ul>
    </div>

    <!-- Curiosidades -->
    <div class="facts">
      <div id="fact-box" class="fact active">Carregando curiosidades‚Ä¶</div>
    </div>

    <!-- QR -->
    <div class="qr-block">
      <div class="qr-pulse"></div>
      <img id="qr" class="qr" alt="QR para jogar"/>
      <div class="cta">Aponte a c√¢mera e participe!</div>
    </div>
  </div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
  import { getFirestore, collection, query, orderBy, limit, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

  /* Firebase */
  const firebaseConfig = {
    apiKey: "AIzaSyC2l8LU3vYfQjTly8JSa658mfIlVk2Dw8E",
    authDomain: "inovacao-emr.firebaseapp.com",
    projectId: "inovacao-emr",
    storageBucket: "inovacao-emr.firebasestorage.app",
    messagingSenderId: "1075399271811",
    appId: "1:1075399271811:web:f532f25547125d6a8f42b6",
    measurementId: "G-8CTLMNCZJN"
  };
  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  /* Ranking */
  const rankEl = document.getElementById('rank');
  const fmt = t => Number.isFinite(+t) ? `${(+t).toFixed(1)}s` : '-';

  function renderRank(data){
    rankEl.innerHTML = "";
    data.slice(0,5).forEach((p,i)=>{
      let medal = "";
      if(i===0) medal="gold"; else if(i===1) medal="silver"; else if(i===2) medal="bronze";
      const li = document.createElement('li');
      li.className = `rank-item ${medal}`;
      li.innerHTML = `<div class="rank-pos">${i+1}</div><span>${p.name||"-"}</span><div>${p.score||0}</div>`;
      rankEl.appendChild(li);
    });
  }

  const q = query(collection(db,"scores"), orderBy("score","desc"), limit(5));
  onSnapshot(q, snap=>{
    const arr = snap.docs.map(d=>d.data())
      .sort((a,b)=>(b.score??0)-(a.score??0)||(a.totalTime??9e9)-(b.totalTime??9e9));
    renderRank(arr);
  });

  /* Curiosidades */
  const facts = [
    "üí° Inova√ß√£o disruptiva transforma mercados inteiros.",
    "üöÄ Hackathons aceleram ideias em apenas 48h.",
    "üåç Sustentabilidade √© motor de inova√ß√£o no setor el√©trico.",
    "ü§ñ IA generativa j√° auxilia na prototipagem de produtos.",
    "üìä Dados s√£o o novo combust√≠vel para decis√µes estrat√©gicas."
  ];
  const factBox = document.getElementById("fact-box");
  let idx=0;
  function nextFact(){
    factBox.classList.remove("active");
    setTimeout(()=>{
      factBox.textContent=facts[idx%facts.length];
      factBox.classList.add("active");
      idx++;
    },400);
  }
  setInterval(nextFact,8000);

  /* QR */
  const base = location.origin + location.pathname.replace(/placar\.html$/,'');
  document.getElementById('qr').src =
    `https://api.qrserver.com/v1/create-qr-code/?size=400x400&data=${encodeURIComponent(base)}`;
</script>
</body>
</html>
