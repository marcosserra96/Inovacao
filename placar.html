<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Placar ‚Äî Innovation Break</title>
  <link rel="stylesheet" href="assets/styles.css"/>
</head>
<body>
  <main class="board">
    <!-- Lado esquerdo -->
    <aside class="side">
      <div class="frame">
        <div class="frame-inner"><img id="photoL" alt=""></div>
      </div>
    </aside>

    <!-- Conte√∫do central -->
    <section class="content">
      <h1>üèÜ TOP 5</h1>
      <ul id="ranking" class="ranking"></ul>
      <p id="curiosity" class="curiosity">üí° Curiosidade aparecer√° aqui...</p>
      <div class="qrcode">
        <img src="assets/qrcode.png" alt="QR para participar"/>
        <p>üì≤ Aponte a c√¢mera e participe!</p>
      </div>
    </section>

    <!-- Lado direito -->
    <aside class="side">
      <div class="frame right">
        <div class="frame-inner"><img id="photoR" alt=""></div>
      </div>
    </aside>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
    import { getFirestore, collection, query, orderBy, limit, onSnapshot } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

    // Config Firebase
    const firebaseConfig = {
      apiKey: "SUA-CHAVE",
      authDomain: "inovacao-emr.firebaseapp.com",
      projectId: "inovacao-emr",
      storageBucket: "inovacao-emr.appspot.com",
      messagingSenderId: "1075399271811",
      appId: "1:1075399271811:web:f532f25547125d6a8f42b6"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // Ranking em tempo real
    const rankingEl = document.getElementById("ranking");
    function renderRanking(arr){
      rankingEl.innerHTML="";
      arr.forEach((p,i)=>{
        const li=document.createElement("li");
        li.innerHTML=`<span class="pos">${i+1}</span> <span class="name">${p.name||"-"}</span> <span class="score">${p.score||0}</span>`;
        rankingEl.appendChild(li);
      });
    }
    onSnapshot(query(collection(db,"scores"),orderBy("score","desc"),limit(5)), snap=>{
      const arr=[]; snap.forEach(d=>arr.push(d.data()));
      renderRanking(arr);
    });

    // Curiosidades alternando
    const curiosities=[
      "üí° Dados s√£o o novo combust√≠vel para decis√µes estrat√©gicas.",
      "üí° Design Thinking resolve problemas com foco no usu√°rio.",
      "üí° Inova√ß√£o disruptiva cria novos mercados.",
      "üí° Pequenas melhorias geram grandes resultados no longo prazo."
    ];
    const curEl=document.getElementById("curiosity");
    let ci=0; setInterval(()=>{
      curEl.textContent=curiosities[ci%curiosities.length];
      ci++;
    },7000);

    // Fotos laterais
    const leftImg=document.getElementById("photoL");
    const rightImg=document.getElementById("photoR");
    let photos=[], li=0, ri=1;

    async function fetchPhotos(){
      try{
        const res=await fetch(`photos/photos.json?_=${Date.now()}`);
        const json=await res.json();
        if(Array.isArray(json.images)) photos=json.images.map(f=>`photos/${f}`);
      }catch{}
    }
    function preload(url){
      return new Promise((ok,fail)=>{
        const img=new Image(); img.src=`${url}?_=${Date.now()}`;
        img.onload=()=>ok(img.src); img.onerror=fail;
      });
    }
    async function swap(el,idx){
      if(!photos.length) return;
      try{el.src=await preload(photos[idx%photos.length]);}
      catch{}
    }
    async function flip(){ await swap(leftImg,li++); await swap(rightImg,ri++); }
    await fetchPhotos(); await flip();
    setInterval(flip,6000); setInterval(fetchPhotos,20000);
  </script>
</body>
</html>
