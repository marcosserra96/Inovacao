<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Placar ‚Äî Quiz EMR</title>
<style>
  :root{
    --ink:#eaf7fb; --muted:#9db4be;
    --teal:#00a6c9; --green:#59c085; --dark:#0a1519;
    --gold:#ffd76a; --silver:#cfd4da; --bronze:#d18a49;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:var(--dark);color:var(--ink);
    font-family:Inter, "Segoe UI", system-ui, -apple-system, Arial, sans-serif;overflow:hidden;}

  /* bg animado sutil */
  .bg{
    position:fixed; inset:-40% -40%;
    background:
      radial-gradient(1200px 1200px at 10% 0%, rgba(0,166,201,.18), transparent 60%),
      radial-gradient(1200px 1200px at 100% 100%, rgba(89,192,133,.14), transparent 60%),
      radial-gradient(900px 900px at 50% 50%, rgba(255,255,255,.03), transparent 70%),
      linear-gradient(120deg,#0a1519,#0b1a21 60%,#0a1519);
    animation: drift 18s linear infinite alternate;
    filter: saturate(1.05);
    z-index:0;
  }
  @keyframes drift{to{transform:translate3d(-2%,1%,0) scale(1.02)}}

  /* grade 3 colunas (512x512 friendly) */
  .stage{
    position:relative; z-index:1;
    max-width:512px; max-height:512px; width:100vmin; height:100vmin; margin:auto;
    display:grid; grid-template-columns:90px 1fr 90px; grid-template-rows:auto 1fr auto;
    gap:8px; padding:10px;
  }

  /* topo ‚Äúlimpo‚Äù: t√≠tulo central + badges abaixo */
  .top{grid-column:1/4; display:flex; flex-direction:column; align-items:center; gap:6px}
  .title{display:flex; align-items:center; gap:8px; font-weight:1000; font-size:28px; letter-spacing:.02em}
  .badges{display:flex; gap:8px; flex-wrap:wrap; justify-content:center}
  .badge{background:#0f2730; border:1px solid rgba(255,255,255,.06); color:var(--muted);
    padding:6px 10px; border-radius:999px; font-weight:800; font-size:12px}

  /* laterais (slides de fotos) */
  .side{grid-row:2/4; display:flex; align-items:center; justify-content:center}
  .frame{
    width:84px; height:112px; background:#fff; border-radius:10px; padding:6px 6px 18px;
    box-shadow:0 10px 24px rgba(0,0,0,.35), 0 0 0 1px rgba(255,255,255,.05) inset;
    transform:rotate(-2deg);
  }
  .frame img{
    width:100%; height:100%; object-fit:cover; border-radius:6px; display:block;
  }
  .frame.right{ transform:rotate(2deg); }

  /* ranking no centro */
  .board{grid-column:2/3; grid-row:2/3; display:flex; flex-direction:column; gap:8px}
  .list{display:flex; flex-direction:column; gap:8px; margin:0; padding:0; list-style:none}
  .row{
    display:grid; grid-template-columns:46px 1fr 110px; align-items:center; gap:12px;
    background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.04));
    border:1px solid rgba(255,255,255,.07); border-radius:16px; padding:10px 12px;
    box-shadow:0 2px 14px rgba(0,0,0,.22);
  }
  .pos{font-weight:900; font-size:20px; text-align:center; opacity:.95}
  .name{font-weight:800; font-size:20px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
  .score{font-weight:900; font-size:20px; text-align:right}
  .meter{grid-column:2/3; height:6px; background:#0c2a33; border-radius:999px; overflow:hidden}
  .meter>.bar{height:100%; width:0; background:linear-gradient(90deg,var(--teal),var(--green)); transition:width .4s ease}
  .gold .pos,.gold .score{color:var(--gold)}
  .silver .pos,.silver .score{color:var(--silver)}
  .bronze .pos,.bronze .score{color:var(--bronze)}
  .glow{box-shadow:0 0 0 0 rgba(255,215,106,.55); animation:glow 1.2s ease}
  @keyframes glow{0%{box-shadow:0 0 0 0 rgba(255,215,106,.55)}100%{box-shadow:0 0 0 24px rgba(255,215,106,0)}}

  /* curiosidade + QR embaixo */
  .foot{grid-column:1/4; display:flex; flex-direction:column; align-items:center; gap:6px}
  .fact{min-height:42px; text-align:center; color:#d6eef5; font-weight:800; font-size:16px}
  .fade{opacity:0; transform:translateY(6px); transition:.5s ease}
  .fade.show{opacity:1; transform:none}
  .qrwrap{position:relative; display:flex; flex-direction:column; align-items:center; gap:4px}
  .qr{width:220px;height:220px;border-radius:18px;border:6px solid #fff; box-shadow:0 8px 28px rgba(0,0,0,.45)}
  .pulse{position:absolute; width:250px; height:250px; border-radius:50%; box-shadow:0 0 0 0 rgba(0,166,201,.35); animation:pulse 2s infinite}
  @keyframes pulse{70%{box-shadow:0 0 0 28px rgba(0,166,201,0)}}
  .hint{color:var(--muted); font-weight:900; font-size:12px}
</style>
</head>
<body>
<div class="bg"></div>

<div class="stage">
  <!-- laterais com fotos -->
  <aside class="side"><div class="frame"><img id="photoL" alt=""></div></aside>

  <!-- topo -->
  <header class="top">
    <div class="title">üèÜ TOP 5</div>
    <div class="badges">
      <div id="pcount" class="badge">0 participantes</div>
      <div id="updated" class="badge">atualizado agora</div>
    </div>
  </header>

  <!-- ranking central -->
  <main class="board">
    <ul id="list" class="list">
      <li class="row"><div class="pos">‚Äì</div><div class="name">Carregando‚Ä¶</div><div class="score">0</div></li>
    </ul>
  </main>

  <!-- lateral direita -->
  <aside class="side"><div class="frame right"><img id="photoR" alt=""></div></aside>

  <!-- rodap√©: curiosidade + QR -->
  <footer class="foot">
    <div class="fact"><span class="fade show" id="fact">Carregando curiosidades‚Ä¶</span></div>
    <div class="qrwrap">
      <div class="pulse"></div>
      <img id="qr" class="qr" alt="QR para jogar">
      <div class="hint">Aponte a c√¢mera e participe</div>
    </div>
  </footer>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
  import { getFirestore, collection, query, orderBy, limit, onSnapshot, getCountFromServer } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyC2l8LU3vYfQjTly8JSa658mfIlVk2Dw8E",
    authDomain: "inovacao-emr.firebaseapp.com",
    projectId: "inovacao-emr",
    storageBucket: "inovacao-emr.firebasestorage.app",
    messagingSenderId: "1075399271811",
    appId: "1:1075399271811:web:f532f25547125d6a8f42b6",
    measurementId: "G-8CTLMNCZJN"
  };
  const app = initializeApp(firebaseConfig);
  const db  = getFirestore(app);

  const listEl   = document.getElementById('list');
  const pcountEl = document.getElementById('pcount');
  const updated  = document.getElementById('updated');

  // QR para a home
  const home = location.origin + location.pathname.replace(/placar\.html$/,'');
  document.getElementById('qr').src =
    `https://api.qrserver.com/v1/create-qr-code/?size=400x400&data=${encodeURIComponent(home)}`;

  let lastTop = null;
  function renderList(arr){
    listEl.innerHTML = '';
    if(!arr.length){
      listEl.innerHTML = `<li class="row"><div class="pos">‚Äì</div><div class="name">Sem resultados ainda</div><div class="score">0</div></li>`;
      return;
    }
    const best = arr[0]?.score ?? 1;
    arr.slice(0,5).forEach((x,i)=>{
      const li = document.createElement('li'); li.className='row';
      if (i===0) li.classList.add('gold'); if (i===1) li.classList.add('silver'); if (i===2) li.classList.add('bronze');
      const pct = Math.max(0, Math.min(1, (x.score||0)/best));
      li.innerHTML = `
        <div class="pos">${i+1}</div>
        <div class="name">${(x.name||'-').toString().slice(0,40)}</div>
        <div class="score">${x.score ?? 0}</div>
        <div class="meter"><div class="bar" style="width:${pct*100}%"></div></div>`;
      listEl.appendChild(li);
    });
    // glow ao trocar l√≠der
    const topMail = (arr[0]?.email||'').toLowerCase();
    if (lastTop !== null && lastTop !== topMail){
      listEl.firstElementChild.classList.add('glow');
      setTimeout(()=> listEl.firstElementChild?.classList.remove('glow'), 1200);
    }
    lastTop = topMail;
    updated.textContent = 'atualizado agora';
    setTimeout(()=> updated.textContent = 'atualizado h√° alguns segundos', 3500);
  }

  const qTop = query(collection(db,"scores"), orderBy("score","desc"), limit(5));
  onSnapshot(qTop, snap=>{
    const arr = snap.docs.map(d=>d.data())
      .sort((a,b)=> (b.score??0)-(a.score??0) || (a.totalTime??9e9)-(b.totalTime??9e9));
    renderList(arr);
  });

  async function refreshCount(){
    try{
      const c = await getCountFromServer(collection(db,"scores"));
      const n = c.data().count || 0;
      pcountEl.textContent = `${n} participante${n===1?'':'s'}`;
    }catch{}
  }
  refreshCount(); setInterval(refreshCount, 15000);

  // Curiosidades
  const facts = [
    "Design Thinking resolve problemas com foco no usu√°rio.",
    "Falhar r√°pido e barato acelera o aprendizado.",
    "Dados s√£o o novo combust√≠vel para decis√µes estrat√©gicas.",
    "IA generativa cria prot√≥tipos e conte√∫dos em minutos.",
    "Inova√ß√£o tamb√©m √© processo, modelo de neg√≥cio e cultura."
  ];
  const factEl = document.getElementById('fact'); let fi=0;
  function nextFact(){ factEl.classList.remove('show'); setTimeout(()=>{ factEl.textContent=facts[fi++%facts.length]; factEl.classList.add('show'); },250); }
  nextFact(); setInterval(nextFact, 8000);

  // ======= SLIDES DE FOTOS (laterais) =======
  const leftImg  = document.getElementById('photoL');
  const rightImg = document.getElementById('photoR');
  let photos = [], li=0, ri=1;

  async function fetchPhotos(){
    try{
      // revalida a cada 20s para pegar novas fotos (cache-busting)
      const res = await fetch(`photos/photos.json?_=${Date.now()}`);
      const json = await res.json();
      if (Array.isArray(json.images) && json.images.length){
        // normaliza URLs relativas √† pasta photos/
        photos = json.images.map(n => `photos/${n}`);
      }
    }catch(e){ /* mant√©m as atuais */ }
  }
  function flipSides(){
    if (!photos.length) return;
    leftImg.src  = photos[li % photos.length];  li++;
    rightImg.src = photos[ri % photos.length];  ri++;
  }
  await fetchPhotos();
  flipSides();
  setInterval(flipSides, 6000);
  setInterval(fetchPhotos, 20000); // busca novas

</script>
</body>
</html>
